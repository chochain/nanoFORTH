<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nanoFORTH: .2 How</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nanoFORTH
   &#160;<span id="projectnumber">v1.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">.2 How </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Start wiring up your breadboard and ready to have some fun? Well, since FORTH is such a different language, a better preparation is always recommended...</p>
<h3>An Interactive FORTH Tutorial</h3>
<p>If your programming language exposure has been with C, Java, or even Python so far, FORTH is quite <b>different</b>. Quote Nick: <em>"It's no functional or object oriented, it doesn't have type-checking, and it basically has zero syntax"</em>. No syntax? So, anyway, before you dive right into the deep-end, here's a good online materials.</p><ul>
<li>Interactive tutorial for FORTH primer. It teaches you how FORTH fundamentally works such as the numbers, the stack, and the dictionary. <blockquote class="doxtable">
<p><a href="https://skilldrick.github.io/easyforth/#introduction" target="_blank">Easy Forth Tutorial by Nick Morgan</a> </p>
</blockquote>
</li>
</ul>
<p>You can skip to next section and start getting your hands dirty right away. However, if you prefer gathering all the sticks before starting a fire or enjoy immersing yourself in the philosophical wonderland of FORTH, excellent online e-books are here free for you.</p><ul>
<li>Timeless classic for the history, paths, and thoughts behind FORTH language. <blockquote class="doxtable">
<p><a href="http://home.iae.nl/users/mhx/sf.html" target="_blank">Starting Forth by Leo Brodie</a><br  />
 <a href="http://thinking-forth.sourceforge.net" target="_blank">Thinking Forth by Leo Brodie</a> </p>
</blockquote>
</li>
</ul>
<h3>Install nanoFORTH - to be simple and useful</h3>
<ul>
<li>From Arduino IDE's Library Manager <blockquote class="doxtable">
<p><br  />
 &gt; Make sure you've hooked up one of Arduino Nano/Uno, or a development board that hosts ATmega328</p>
<p>&gt; from Arduino IDE &gt; Tools &gt; Manage Libraries, enter FORTH in search box</p>
<p>&gt; find nanoFORTH in the short list, select the latest version, and click the Install button</p>
<p>&gt; from Files &gt; Examples, find nanoForth in Examples from Custom Libraries at very buttom section</p>
<p>&gt; load one of the nanoForth examples, such as 0_blink</p>
<p>&gt; open Serial Monitor, set baud rate to 115200, and line ending to 'Both NL &amp; CR'</p>
<p>&gt; hit compile and upload. You should see the 'ok' prompt, and the built-in LED should be blinking</p>
<p>&gt; in Serial Monitor input bar atop, type WRD and hit &lt;return&gt;. See what nanoFORTH says.<br  />
<br  />
 </p>
</blockquote>
</li>
<li>or, from GitHub directly, if you prefer managing source codes manually <blockquote class="doxtable">
<p><br  />
 &gt; git clone <a href="https://github.com/chochain/nanoFORTH">https://github.com/chochain/nanoFORTH</a> onto your local Sketch directory</p>
<p>&gt; copy examples/0_blink/0_blink.ino from sub-directory, then rename it as nanoFORTH.ino<br  />
</p>
<p>&gt; open nanoFORTH.ino with Arduino IDE, and setup your Nano/Uno (or ATmega328) development board</p>
<p>&gt; in nanoFORTH.ino, change the #include &lt;<a class="el" href="nanoFORTH_8h.html" title="nanoForth Arduino interface">nanoFORTH.h</a>&gt; to #include "./src/nanoFORTH.h"</p>
<p>&gt; open Serial Monitor, set baud rate to 115200, and line ending to 'Both NL &amp; CR'</p>
<p>&gt; compile and upload, you should see the 'ok' prompt, and the built-in LED is blinking</p>
<p>&gt; in Serial Monitor input bar atop, type WRD and hit &lt;return&gt;. See what nanoFORTH says.<br  />
<br  />
 </p>
</blockquote>
</li>
<li>Hopefully, thing goes well and you get something like this if nanoFORTH is uploaded successfully <blockquote class="doxtable">
<p><br  />
 </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">screen shot  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div class="image">
<img src="nanoforth_init_screen.png" alt=""/>
</div>
 </td></tr>
</table>
</blockquote>
<br  />
</li>
</ul>
<h3>Exercise</h3>
<p>We have gone through a lot of 'paper work', time for some hands-on again. If needed, or you've skipped through somehow, please do review the previous page <a href="page1.html" target="_blank">HERE (the Why page)</a> for some instructions we've gone through earlier.</p>
<p>Now let's try some fancy stuffs to see what nanoFORTH has to offer.</p><ul>
<li>Turn the tracing flag on, and try everything we did in the previous page. <blockquote class="doxtable">
<p>1 TRC ⏎<br  />
 <b>lit</b> <b>?z</b> </p>
</blockquote>
</li>
<li>If it's too much info for you, then turn the tracing off. <blockquote class="doxtable">
<p>0 TRC ⏎<br  />
 </p>
</blockquote>
</li>
<li>To do some logic ops in hex, and back in decimal, we can do this. <blockquote class="doxtable">
<p>HEX ⏎<br  />
 40 38 ⇨ 40_38_ok OR ⏎<br  />
 78_ok DEC ⏎<br  />
 ⇨ 120_ok </p>
</blockquote>
</li>
<li>Get Arduino clock/millis, a double precision (i.e. 32-bit) value. <blockquote class="doxtable">
<p>CLK ⏎<br  />
 ⇨ 17786_9_ok </p><blockquote class="doxtable">
<p>&gt; nanoFORTH uses two 16-bit cells on data stack to represent the 32-bit number<br  />
 &gt; note the numbers above are for example only, your clock read will be different </p>
</blockquote>
</blockquote>
</li>
<li>To benchmark something, let's define a function <b>zz</b> that runs in empty loops and time it. <blockquote class="doxtable">
<p>: <b>zz</b> 10000 FOR NXT ;⏎<br  />
 CLK DNG <b>zz</b> CLK D+ ⏎<br  />
 ⇨ 103_0_ok </p><blockquote class="doxtable">
<p>&gt; Our ten-thousand cycles are completed in 103ms, i.e. ~10us/cycle, not too shabby!<br  />
 &gt; DNG negate the first clock ticks<br  />
 &gt; D+ add two clock counts (i.e. (-t0) + t1) to deduce the time difference </p>
</blockquote>
</blockquote>
</li>
<li>To find out how many bytes of memory has been used. <blockquote class="doxtable">
<p>HRE ⏎<br  />
 ⇨ 76_ok </p>
</blockquote>
</li>
<li>To dump the memory to see how all these words are encoded in the dictionary. <blockquote class="doxtable">
<p>0 HRE DMP ⏎ </p><blockquote class="doxtable">
<p>&gt; There! You can see the hex dump of our <b>red</b> ... <b>blu</b> ...<br  />
 &gt; in their gory detail all the way up to the latest word <b>zz</b> </p>
</blockquote>
</blockquote>
</li>
<li>At the end of the day, or to prevent a power outage hit, we can save what's been done so far into EEPROM. <blockquote class="doxtable">
<p>SAV ⏎ </p>
</blockquote>
</li>
<li>When needed, we can zap the sandbox i.e. reset the nanoFORTH system pointers for a fresh start. <blockquote class="doxtable">
<p>BYE ⏎<br  />
 ⇨ nanoFORTH v2.0 ok </p><blockquote class="doxtable">
<p>&gt; The data stack, return stack, and instruction pointers will be reinitialized </p>
</blockquote>
</blockquote>
</li>
<li>After restart your Arduino, words can be restored from EEPROM where you saved earlier. <blockquote class="doxtable">
<p>LD ⏎<br  />
 0 HRE DMP ⏎ </p>
</blockquote>
</li>
</ul>
<p>Alright! That has pretty much concluded our rounds of exercise. You probably have wondered that if the SAV/LD pair can provide the ability to withstand power failures, can it be rebooted in the field for our future apps on Nanos? Well, yes! To do that, we have another word for you - <b>SEX</b> - it is! Short for Save and Execute. It saves the dictionary into EEPROM and set the autorun flag. When your Arduino reboots, the flag in EEPROM is checked. If it is indeed set, the last word saved will be executed.</p><ul>
<li>Here's one example for a turnkey start up. <blockquote class="doxtable">
<p>: <b>fun</b> ( - - ) 1000 DLY ." I'm alive! blink " 20 <b>xy</b> ; ⏎<br  />
 SEX ⏎<br  />
 BYE ⏎<br  />
 ⇨ nanoFORTH v2.0 reset<br  />
 ⇨ I'm alive! blink 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 ok<br  />
 </p><blockquote class="doxtable">
<p>&gt; When you entered BYE this time, nanoFORTH reboot and runs the last word you've saved. In our case, it is <b>fun</b>, the blinker.<br  />
 &gt; Note that the ( - - ) is a Forth-style comment that you can use. A \ (back slash) can also be used to ignore comments to the end of your input line.<br  />
 &gt; if you missed how <b>xy</b> worked, you might need to revisit the previous page <a href="page1.html" target="_blank">HERE</a> </p>
</blockquote>
</blockquote>
</li>
<li>To disable the autorun, a normal SAV again will clear the flag. It does keep your dictionary intact in EEPROM, i.e. words you've created before are still in place. <blockquote class="doxtable">
<p>SAV ⏎<br  />
 BYE ⏎<br  />
 ⇨ nanoFORTH v2.0 ok </p>
</blockquote>
</li>
</ul>
<p>We know microcontrollers in the field are often built to run in an endless loop. But, before you get creative and save the wonderful turnkey application into EEPROM, make sure you know how to get out of a reboot loop. Since it might be your last word, do double check it. Regardless, if you found your Arduino is stuck, all is not lost. It's a bit messy but basically you need to compile/upload another .ino file that can wipe the EEPROM before you can reload nanoFORTH (or it will try loading your code from EEPROM and autoexec again).</p>
<p>OK, if you feel good so far, we can try some fancy stuffs. nanoFORTH uses Arduino 8-bit Timer2 for its internal "ticker". The 16-bit Timer1 is purposely left for other libraries such as Servo, AltSoftSerial. There are 8 slots available for timer interrupt handlers. You can install or replace service routines in each slot independently (and on the fly if you want to). Signal changed from either HIGH to LOW or LOW to HIGH can be track by installing Ping Change Interrupt handler.</p>
<ul>
<li>Multi-task with timer interrupt that blinks red LED at 100ms interval. <blockquote class="doxtable">
<p>: <b>tic</b> 5 IN 1 XOR 5 OUT ; ⏎<br  />
 100 0 <b>TMI</b> tic ⏎<br  />
 1 TME ⏎<br  />
 </p><blockquote class="doxtable">
<p>&gt; put our word <b>tic</b> in timer interrupt handler slot 0 and to serve at 100ms interval,<br  />
 &gt; 1 TME turns on timer interrupt, the red LED should start blinking, and 0 TME will turns it off, of course<br  />
 </p>
</blockquote>
</blockquote>
</li>
<li>Track pin signal changed with Ping Change Interrupt. <blockquote class="doxtable">
<p>12 <b>PCI</b> tic ⏎<br  />
 </p><blockquote class="doxtable">
<p>&gt; when pin 12 signal changed, <b>tic</b> will be called.<br  />
 Note that, limited by design, Arduino ping change interrupt groups pings into only 3 ports (i.e. 0~7, 8~13, A0~A7). So if you have both pin 4 and 5 (in the same group) enabled, only one call to <b>tic</b> if signals changed. To identify which pin changed, you need to read the port themselves to make sure. Read <a href="https://electronoobs.com/eng_arduino_tut132.php" target="_blank">this site</a> for details. </p>
</blockquote>
</blockquote>
</li>
</ul>
<p>All in all, nanoFORTH is <b>real-time</b>, and can <b>multi-task</b>. It is <b>interactive</b> and <b>extensible</b>. It can be reprogrammed on-the-fly or even over-the-air. Many many exciting stuffs can be added onto this simple system. Hopefully, this is a start of a fun journey far and beyond.</p>
<p><br  />
 <a href="page1.html">1. Why - Review nanoFORTH command examples</a><br  />
 <a href="page3.html">3. What - Learn nanoFORTH internal details</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
