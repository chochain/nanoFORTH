<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nanoFORTH: .1 Why</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nanoFORTH
   &#160;<span id="projectnumber">v1.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">.1 Why </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The emerging micro-controller communities are being built no more around specific hardware form factor, but rather around higher level languages. Without introducing an interactive shell like Javascript or microPython supported by ESP or Raspberry, the once popular Arduino platform will gradually lose out the market. However, no matter how the hardware environment evolved, on the edge of IoT universe, a minimalist system resembles the Aruino UNO will always have its value of existence provided that some of the form-factor might one-day shrunk down to micro or even nano-scale. Being chip agnostic, the Arduino IDE does serve as an excellent learning tool for future systems to come. Factor software development time into the mix, an interactive/interpreted language is not only cheaper but more fun than the good old static compiled C code in many cases. Check out <a href="https://www.forth.com/resources/space-applications" target="_blank">NASA</a> and contemplate why FORTH is still running on a number of space probes today.</p>
<p>Following the footsteps of <a href="http://middleriver.chagasi.com/electronics/tforth.html" target="_blank">Nakagawa</a> and <a href="https://circuit4us.medium.com/tiny-forth-with-arduino-hardware-support-255f408b745a" target="_blank">circuit4u@medium.com's</a> <b>TinyForth</b>, a light-weight protothreaded FORTH with 3-character keywords for Arduino, I got an idea!</p>
<h2>nanoFORTH - a simple and useful FORTH for Arduino Nano</h2>
<h3>Assumptions</h3>
<ul>
<li>more than 80% of Arduino makers are using UNO or Nano,</li>
<li>most of the makers do not need the full-blown FORTH vocabularies,</li>
<li>most of them are not familiar with standard FORTH words, so abbreviation for words is OK,</li>
<li>the meta-compiler is unlikely needed either, i.e. not to create a new type of Forth from within nanoForth,</li>
<li>only a small set of, say 50+, core primitive words are needed for the most of Arduino projects, the rationale being anything that requires more elaborated syntax, one might need the power of ESPs.</li>
</ul>
<h3>Requirements</h3>
<ul>
<li>be as simple to use as any example Sketch that comes with the IDE (no bootloader burning),</li>
<li>provide a REPL development/operating environment for Arduino,</li>
<li>provide core Arduino functions (i.g. pinMode, digitalRead/Write, analogRead/Write, millis, delay),</li>
<li>provide an Arduino library that developers can include easily,</li>
<li>provide at least 1K RAM dictionary for reasonably size of work,</li>
<li>utilize EEPROM as the persistant storage for user defined words that can be reloaded after restart,</li>
<li>provide C API so that user defined functions/components can be integrated (ig. Servo, Bluetooth, ...),</li>
<li>provide timer interrupt handler to support multi-tasking,</li>
<li>privide pin change interrupt handler to support hardware trigger,</li>
<li>show assembly trace (i.e. byte-code stream) to help beginners to understand FORTH internal,</li>
<li>show execution trace to enable debugging, also provision for single-stepping.</li>
<li>capable of autorun after reboot (from saved EEPROM image).</li>
</ul>
<h3>Use Cases - Interaction Examples</h3>
<ul>
<li>Turn on LED(red) on digital pin 5, imagine you have a board hooked up, or try <a href="https://wokwi.com/projects/359920992049600513" target="_blank">check this Wokwi project</a> <blockquote class="doxtable">
<p>1 5 OUT ⏎ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div class="image">
<img src="nanoforth_led_red.jpg" alt="" width="200px</td>"/>
</div>
 </td></tr>
</table>
</blockquote>
<br  />
</li>
<li>Turn off LED(blue) on digital pin 6, (0 is LOW). <blockquote class="doxtable">
<p>0 6 OUT ⏎ </p>
</blockquote>
</li>
<li>Tefine a function, or a 'word' in FORTH, <b>red</b> to turn red LED on, and blue LED off. <blockquote class="doxtable">
<p>: <b>red</b> 1 5 OUT 0 6 OUT ; ⏎ </p><blockquote class="doxtable">
<p>&gt; the symbol : starts the definition, and ; ends the function (or word) definition </p>
</blockquote>
</blockquote>
</li>
<li>Define another word <b>blu</b> to turn red LED off and turn blue LED on (sorry, no blue, nanoFORTH takes max 3 characters only). <blockquote class="doxtable">
<p>: <b>blu</b> 0 5 OUT 1 6 OUT ; ⏎ </p>
</blockquote>
</li>
<li>Execute <b>blu</b>, i.e. to turn red LED off, and blue LED on. <blockquote class="doxtable">
<p><b>blu</b> ⏎ </p><blockquote class="doxtable">
<p>&gt; a function is defines in the 'Compile Mode', and executed in 'Interpreter Mode'. The differece is at the leading ':' (colon) sign. </p>
</blockquote>
</blockquote>
</li>
<li>Define a word <b>xy</b> to blink red/blue every 500 ms alternatively. <blockquote class="doxtable">
<p>: <b>xy</b> FOR <b>red</b> 500 DLY <b>blu</b> 500 DLY NXT ; ⏎ </p>
</blockquote>
</li>
<li>Run 10 cycles of <b>xy</b>. <blockquote class="doxtable">
<p>10 <b>xy</b> ⏎ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"> <iframe width="400" height="320" src="https://www.youtube.com/embed/trmDNh41-pQ?version=3&playlist=trmDNh41-pQ&loop=1&controls=0" title="" frameborder="0" allow="autoplay; picture-in-picture" allowfullscreen></iframe>   </td></tr>
</table>
<blockquote class="doxtable">
<p>&gt; so, 10 FOR ... NXT is to loop 10 times, (counting down from 10, 9, 8, ..., 2, 1) </p>
</blockquote>
</blockquote>
</li>
<li>If that's a bit too slow! nanoFORTH allows you redefine <b>xy</b> by "forget" it first. <blockquote class="doxtable">
<p>FGT <b>xy</b> ⏎<br  />
 </p><blockquote class="doxtable">
<p>&gt; that erased <b>xy</b> from memory, we can redefine it now<br  />
 &gt; actually, multiple definition of the same function is allowed, the latest one takes precedence.<br  />
 &gt; also, FGT a word that is an interrupt service (see page3) might cause undefined behaviour </p>
</blockquote>
<p>: <b>xy</b> FOR <b>red</b> 200 DLY <b>blu</b> 300 DLY <b>I .</b> NXT ; ⏎<br  />
 </p>
</blockquote>
</li>
<li>Now, try 20 cycles of <b>xy</b> this time. <blockquote class="doxtable">
<p>20 <b>xy</b> ⏎ ⇨ 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 ok </p><blockquote class="doxtable">
<p>&gt; so, you've probably noticed that <b>I</b> is the loop counter and . (dot) prints it<br  />
 </p>
</blockquote>
</blockquote>
</li>
<li>Let's try analog, say read a value from analog pin 1, assuming you have one installed, or again try <a href="https://wokwi.com/projects/359920992049600513" target="_blank">this Wokwi project</a> <blockquote class="doxtable">
<p>1 AIN ⏎<br  />
 ⇨ 258_ok </p><blockquote class="doxtable">
<p>&gt; 258 is the value nanoFORTH read from photoresister, then place it on top of data stack &gt; a photoresister or potentiometer returns value between 0 and 1023 </p>
</blockquote>
</blockquote>
</li>
<li>If we don't need the value 258, we can drop it from data stack to keep it clean <blockquote class="doxtable">
<p>DRP ⏎<br  />
 ⇨ ok </p><blockquote class="doxtable">
<p>&gt; 258 is gone now </p>
</blockquote>
</blockquote>
</li>
<li>Define <b>lit</b> to read from photoresister (or a potentiometer) and determine whether its value is &gt; 200. <blockquote class="doxtable">
<p>: <b>lit</b> 1 AIN 200 &gt; ; ⏎ </p>
</blockquote>
</li>
<li>Execute <b>lit</b>, it puts value 1 on data stack (FORTH's memory) if your room is bright enough, a value 0 otherwise. <blockquote class="doxtable">
<p><b>lit</b> ⏎<br  />
 ⇨ 1_ok </p>
</blockquote>
</li>
<li>Define <b>?z</b> that turns on red or blue depends on value on top of data stack. <blockquote class="doxtable">
<p>: <b>?z</b> IF <b>red</b> ELS <b>blu</b> THN ; ⏎ </p><blockquote class="doxtable">
<p>&gt; <b>?z</b> is our newly defined function. Unlike most of the other languages, you can create some really strange function names in FORTH. </p>
</blockquote>
</blockquote>
</li>
<li>Run <b>?z</b> which read from top of data stack, if it's 1 then turns on red LED or 0 turns on blue. Try these <blockquote class="doxtable">
<p>1 <b>?z</b> ⏎<br  />
 0 <b>?z</b> ⏎ </p>
</blockquote>
</li>
<li>We now can turn on red or blue LED depend on lighting condition (try blocking the photoresister), <b>lit</b> leaves 1 or 0 on data stack, <b>?z</b> takes the value and turns on the red or blue LED. <blockquote class="doxtable">
<p><b>lit</b> <b>?z</b> ⏎ </p>
</blockquote>
</li>
<li>Define a word <b>xyz</b> to keep checking photoresister, turn the blue or red LED on depending on the photoresister value read until button hooked at pin 7 is pushed. <blockquote class="doxtable">
<p>: <b>xyz</b> BGN <b>lit</b> <b>?z</b> 7 IN UTL ; ⏎<br  />
 <b>xyz</b> ⏎ </p><blockquote class="doxtable">
<p>&gt; Try blocking the photoresister to see the LED toggles.<br  />
 &gt; Can this become a trigger i.e. mouse trap or something useful? Why not!<br  />
 </p>
</blockquote>
</blockquote>
</li>
<li>Let's list all nanoFORTH words available in its dictionary. <blockquote class="doxtable">
<p>WRD ⏎ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"></th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><div class="image">
<img src="nanoforth_wrd_list.png" alt="" width="800px</td>"/>
</div>
 </td></tr>
</table>
<blockquote class="doxtable">
<p>&gt; See the latest, they include <b>xyz</b>, <b>?z</b>, <b>xy</b>, <b>lit</b>, <b>blu</b>, <b>red</b> that we've just created. </p>
</blockquote>
</blockquote>
</li>
</ul>
<p>Behold! This is nanoFORTH in its entirety. It's a short list of 'words' which should be rather easy to master. Note that the steps illustrated above has been the way Forth programmers building their applications. One small word at a time. Debug each well interactively then combine them into a "bigger" word. If a bug found, FGT the word, redefine it. Next word!</p>
<p><br  />
</p>
<p>OK! If the process shown above has captured the essense, we should have an idea of what nanoFORTH is trying to do. Let's just stop and contemplate for a while. We did all of the above without any recompilation. Instead, we "talked" directly with the nanoFORTH uploaded only once via the USB cable. Should you code these in C, how do you go about doing it?</p>
<p>The interactive nature is different from the way we are so used to on Arduino platform. Just consider how many times you have to compile your C code to go through the functions shown above. So, move forward, let's envision how we can control robots or what we can do using Bluetooth with our Nano...</p>
<p><br  />
 <a href="page2.html">2. How - Ready to get nanoFORTH for a trial?</a><br  />
 <a href="page3.html">3. What - References and all the details...</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
